(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{415:function(n,s,e){"use strict";e.r(s);var a=e(25),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"插件顺序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#插件顺序"}},[n._v("#")]),n._v(" 插件顺序")]),n._v(" "),e("ul",[e("li",[n._v("别名处理")]),n._v(" "),e("li",[n._v("用户插件设置 enforce：‘pre'")]),n._v(" "),e("li",[n._v("vite核心插件 (单文件处理)_")]),n._v(" "),e("li",[n._v("用户插件未设置enforce")]),n._v(" "),e("li",[n._v("vite构建插件")]),n._v(" "),e("li",[n._v("用户插件设置 enforce：‘post'")]),n._v(" "),e("li",[n._v("vite构建后置插件（minify,manifest,reporting）")])]),n._v(" "),e("h2",{attrs:{id:"vite-plugin-mock"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vite-plugin-mock"}},[n._v("#")]),n._v(" vite-plugin-mock")]),n._v(" "),e("p",[n._v("给开发服务器实例（connect）配置中间件，该中间件可以存储用户配置接口映射信息，并提前处理输入请求，如果请求的url和路由表匹配则接管，按用户配置的handler返回结果.")]),n._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/senchalabs/connect#readme",target:"_blank",rel:"noopener noreferrer"}},[n._v("vite2内置connect服务"),e("OutboundLink")],1)]),n._v(" "),e("div",{staticClass:"language-javas line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("const path = require('path');\nlet mockRouteMap = {};\nfunction createRoute(mockConfList) {\n    mockConfList.forEach(mockConf => {\n        let method = mockConf.type || 'get'\n        let path = mockConf.url;\n        let handler = mockConf.response;\n        let route = { \n            path,\n            method: method.toLowerCase(),\n            handler\n         }\n         if(!mockRouteMap[method]) {\n            mockRouteMap[method] = []\n         }\n         mockRouteMap[method].push(route)\n    });\n}\n\nfunction matchRoute(req) {\n    let url = req.url;\n    let method = req.method.toLowerCase();\n    let routeList = mockRouteMap[method];\n    return routeList && routeList.find((item) => item.path === url)\n}\n// function send(body) {\n//     let chunk = JSON.stringify(body);\n//     if(chunk) {\n//         chunk = Buffer.from(chunk, 'utf-8');\n//         this.setHeader('Content-Length', chunk.length);\n//     }\n//     this.setHeader('Content-type', 'application/json');\n//     this.statusCode = 200;\n//     this.end(chunk, 'utf-8');\n// }\n\nexport default function(options = {}){\n    const defaultOptions = {\n        entry: path.resolve(__dirname, './mock/index.js')\n    }\n    options = Object.assign(defaultOptions, options)\n    return {\n        configureServer: function({ app }) {\n            // 定义路由表\n            const mockObj = require(options.entry);\n            createRoute(mockObj);\n            const middleware = (req, res, next) => {\n                let route = matchRoute(req);\n                if(route) {\n                    const data = route.handler(req, res)\n                    res.end(JSON.stringify(data));\n                } else {\n                    next();\n                }\n            }\n            app.use(middleware)\n        }\n    }\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br"),e("span",{staticClass:"line-number"},[n._v("57")]),e("br"),e("span",{staticClass:"line-number"},[n._v("58")]),e("br"),e("span",{staticClass:"line-number"},[n._v("59")]),e("br")])]),e("p",[e("strong",[n._v("使用")])]),n._v(" "),e("p",[n._v("mock/index.js")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("module.exports =  [\n    {\n      url: '/api/users',\n      method: 'get',\n      response: () => {\n        return {\n          code: 20000,\n          message: 'ok',\n          data: [{\n            name:'tom'\n          },\n          {\n            name:'jerry'\n          }],\n        };\n      },\n    },\n  ];\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("p",[n._v("vite.config.js")]),n._v(" "),e("div",{staticClass:"language-javas line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import { defineConfig } from 'vite'\nimport viteMockServe from './plugins/vite-plugin-mock';\n\nexport default defineConfig({\n  plugins: [\n    viteMockServe()\n    ]\n})\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])]),e("p",[n._v("vue-plugin-")])])}),[],!1,null,null,null);s.default=t.exports}}]);